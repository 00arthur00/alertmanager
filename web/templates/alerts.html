{{define "alertsTabClass"}}active{{end}}

{{define "head"}}
    <script src="{{ pathPrefix }}static/js/alerts.js"></script>
{{end}}

{{define "content"}}
    <h2>Alerts</h2>
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th></th>
          <th></th>
          <th>Alert</th>
          <th>Labels</th>
          <th>Summary</th>
          <th>Active Since</th>
          <th>Generated By</th>
          <th>Silenced</th>
        </tr>
      </thead>
      <tbody>
        {{$silenceForAlert := .SilenceForAlert}}
        {{range .AlertAggregates}}
          <tr class="alert_overview_row" id="{{.Alert.Fingerprint}}">
            <td class="icon_col alert_expand"><i class="icon-chevron-down"></i></td>
            <td class="icon_col"><a href="#{{.Alert.Fingerprint}}"><i class="icon-bookmark"></i></a></td>
            <td>
              <span class="label label-important">{{index .Alert.Name}}</span>
              <form class="add_silence_form">
                <input type="hidden" name="label[]" value="alertname">
                <input type="hidden" name="value[]" value="{{.Alert.Name}}">
                <a href="#edit_silence_modal" role="button" class="btn btn-mini add_silence_btn" data-toggle="modal">Silence Alert</a>
              </form>
            </td>
            <td>
              {{range $label, $value := .Alert.Labels}}
                {{if not (eq $label "alertname")}}
                  <span class="label label-info">{{$label}}="{{$value}}"</span>
                {{end}}
              {{end}}
              <form class="add_silence_form">
                {{range $label, $value := .Alert.Labels}}
                  <input type="hidden" name="label[]" value="{{$label}}">
                  <input type="hidden" name="value[]" value="{{$value}}">
                {{end}}
                <a href="#edit_silence_modal" role="button" class="btn btn-mini add_silence_btn" data-toggle="modal">Silence Instance</a>
              </form>
            </td>
            <td>{{.Alert.Summary}}</td>
            <td>{{timeSince .Created}} ago</td>
            <td>
              {{if .Alert.Payload.generatorURL}}
                <a href="{{.Alert.Payload.generatorURL}}">{{(truncate .Alert.Payload.generatorURL 40)}}</a>
              {{end}}
            </td>
            <td>
              {{$silence := call $silenceForAlert .Alert}}
              {{if $silence}}
                by <a href="#" class="silence_link">silence {{$silence.ID}}</a>
              {{else}}
                not silenced
              {{end}}
            </td>
          </tr>
          <tr class="alert_detail_row">
            <td colspan="7">
              <table class="table table-bordered">
                <tr>
                  <th>Last received</th>
                  <td>{{timeSince .LastRefreshed}} ago</td>
                </tr>
                <tr>
                  <th>Description</th>
                  <td>{{.Alert.Description}}</td>
                </tr>
                {{if .Alert.Runbook}}
                <tr>
                  <th>Runbook</th>
                  <td>{{.Alert.Runbook}}</td>
                </tr>
                {{end}}
                <tr>
                  <th>Alerting rule</th>
                  <td><pre>{{.Alert.Payload.alertingRule}}</pre></td>
                </tr>
              </table>
            </td>
          </tr>
        {{end}}
      </tbody>
    </table>
    {{template "editSilenceModal" .}}
{{end}}
